"use strict";const e=require("electron"),a=require("path"),d=require("fs");let o=null;function p(r){o=r,e.ipcMain.handle("fs:saveReport",async(n,c,l)=>{try{const s=await e.dialog.showSaveDialog(o,{defaultPath:l,filters:[{name:"Markdown",extensions:["md"]},{name:"JSON",extensions:["json"]},{name:"HTML",extensions:["html"]},{name:"All Files",extensions:["*"]}]});return s.canceled||!s.filePath?{success:!1,canceled:!0}:(d.writeFileSync(s.filePath,c,"utf-8"),{success:!0,path:s.filePath})}catch(s){return{success:!1,error:s.message}}}),e.ipcMain.handle("fs:selectDirectory",async()=>{try{const n=await e.dialog.showOpenDialog(o,{properties:["openDirectory","createDirectory"]});return n.canceled||!n.filePaths.length?{success:!1,canceled:!0}:{success:!0,path:n.filePaths[0]}}catch(n){return{success:!1,error:n.message}}}),e.ipcMain.handle("app:getInfo",async()=>({version:"0.1.0",electron:process.versions.electron,node:process.versions.node,platform:process.platform})),console.log("[IPC] Handlers registered")}try{require("electron-squirrel-startup")&&e.app.quit()}catch{}let t=null;const u=process.env.NODE_ENV==="development"||!e.app.isPackaged;function i(){t=new e.BrowserWindow({width:1280,height:800,minWidth:1024,minHeight:600,webPreferences:{preload:a.join(__dirname,"../preload/index.js"),nodeIntegration:!1,contextIsolation:!0},titleBarStyle:"hiddenInset",trafficLightPosition:{x:15,y:15}}),u?(t.loadURL("http://localhost:5173"),t.webContents.openDevTools()):t.loadFile(a.join(__dirname,"../renderer/index.html")),t.on("closed",()=>{t=null}),p(t)}e.app.whenReady().then(()=>{i(),e.app.on("activate",()=>{e.BrowserWindow.getAllWindows().length===0&&i()})});e.app.on("window-all-closed",()=>{process.platform!=="darwin"&&e.app.quit()});process.on("uncaughtException",r=>{console.error("Uncaught Exception:",r)});process.on("unhandledRejection",(r,n)=>{console.error("Unhandled Rejection at:",n,"reason:",r)});
