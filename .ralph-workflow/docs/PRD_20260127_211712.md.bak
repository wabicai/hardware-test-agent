# Hardware Test Agent - 需求文档 (PRD)

## 1. 项目背景

### 1.1 现状分析
当前 `hardware-js-sdk/packages/connect-examples/expo-example` 项目中已实现了完整的硬件钱包测试套件，包括：

| 测试模块 | 描述 | 当前位置 |
|---------|------|---------|
| Passphrase 测试 | 多钱包切换、Session 管理测试 | `testTools/passphraseTest/` |
| 地址测试 | 单个/批量地址验证（12/18/24词） | `testTools/addressTest/` |
| SLIP39 测试 | SLIP39 助记词地址验证 | `testTools/slip39Test/` |
| 安全检查 | 盲签名安全检测 | `testTools/securityCheckTest/` |
| 功能测试 | 设备锁定、初始化耗时 | `testTools/functionalTesting/` |
| Attach To Pin | 钱包 PIN 绑定测试 | `testTools/attachToPinTest/` |
| 链方法批量测试 | 多链方法批量调用测试 | `testTools/chainMethodTest/` |

### 1.2 问题
1. 当前测试需要在 Expo 移动端运行，不便于持续集成
2. 测试需要手动操作，无法完全自动化
3. 测试结果散落在多处，难以统一管理

## 2. 目标

构建一个**桌面端自动化测试工具**，实现：
1. **完全自动化** - 无需人工干预即可运行全部测试
2. **统一测试管理** - 集中管理所有测试用例和结果
3. **CI/CD 友好** - 支持命令行模式，便于集成到流水线

## 3. 核心功能需求

### 3.1 测试模块（P0）

#### 3.1.1 Passphrase 测试自动化
- [ ] 自动切换多个 Passphrase 钱包
- [ ] 验证地址一致性
- [ ] 支持 BTC/EVM/DOT/ADA/Multi 多链

#### 3.1.2 地址测试自动化
- [ ] 支持 12/18/24 词助记词
- [ ] 支持 normal/passphrase_1/passphrase_2/passphrase_empty 变体
- [ ] 批量验证 40+ 链方法的地址

#### 3.1.3 SLIP39 测试自动化
- [ ] 支持 20/33 词 SLIP39
- [ ] 地址和公钥双重验证
- [ ] 支持多账户变体

#### 3.1.4 安全检查测试
- [ ] 盲签名检测
- [ ] safetyChecks 设置验证

#### 3.1.5 功能测试
- [ ] 设备锁定/解锁检测
- [ ] Passphrase 开关检测
- [ ] 初始化耗时统计

#### 3.1.6 Attach To Pin 测试
- [ ] 主钱包/隐藏钱包管理
- [ ] 地址验证

#### 3.1.7 链方法批量测试
- [ ] BTC/ETH/ADA/SOL/DOT 全链方法测试
- [ ] 支持 bundle 批量调用

### 3.2 自动化能力（P0）

#### 3.2.1 自动 PIN 输入
- [ ] 通过 SDK 事件监听自动响应 PIN 请求
- [ ] 支持配置预设 PIN

#### 3.2.2 自动 Passphrase 输入
- [ ] 监听 Passphrase 请求事件
- [ ] 根据测试用例自动输入对应 Passphrase

#### 3.2.3 自动按钮确认
- [ ] 使用 `showOnOneKey: false` 跳过设备端确认
- [ ] 支持配置是否需要物理确认

### 3.3 测试管理（P1）

- [ ] 测试用例配置（选择要运行的测试模块）
- [ ] 测试队列管理
- [ ] 实时进度展示
- [ ] 结果汇总与导出（Markdown/JSON）

### 3.4 设备管理（P1）

- [ ] 自动发现连接的硬件设备
- [ ] 支持多设备并行测试
- [ ] 设备状态监控

## 4. 技术方案讨论

### 方案一：Electron + React (推荐)
**优点**：
- 可直接复用 expo-example 中的 React 组件和测试逻辑
- 成熟的生态，调试工具完善
- 跨平台支持良好

**缺点**：
- 打包体积较大（~150MB）

**技术栈**：
- Electron 30+
- React 18 + TypeScript
- Vite 作为构建工具
- @onekeyfe/hd-core 作为核心 SDK

### 方案二：Tauri + React
**优点**：
- 打包体积小（~10MB）
- 性能更好

**缺点**：
- 需要 Rust 环境
- 生态相对年轻

### 方案三：纯 Node.js CLI
**优点**：
- 最轻量，CI/CD 友好
- 无 GUI 开销

**缺点**：
- 无可视化界面
- 测试进度和结果不直观

### 方案四：混合方案 - Electron GUI + Node.js CLI
**优点**：
- 核心测试逻辑独立为 CLI 包
- 可选 GUI 用于调试和可视化
- CI/CD 使用 CLI 模式

**实现**：
```
packages/
├── test-core/          # 核心测试逻辑（纯 Node.js）
├── test-cli/           # CLI 命令行工具
└── test-desktop/       # Electron GUI（可选）
```

## 5. 待确认问题

### Q1: 自动化程度
硬件设备上的物理按钮确认是否需要完全跳过？
- A: 使用 `showOnOneKey: false` 可跳过大部分确认
- B: 部分关键操作仍需物理确认

### Q2: 目标用户
- A: 开发者本地测试
- B: CI/CD 自动化流水线
- C: QA 团队测试

### Q3: 框架选择倾向
- A: Electron + React（复用现有代码，快速开发）
- B: Tauri + React（轻量，但需学习成本）
- C: 纯 Node.js CLI（最简单，无界面）
- D: 混合方案（CLI + 可选 GUI）

### Q4: 测试数据管理
- A: 硬编码在代码中（简单）
- B: 外部配置文件（灵活）
- C: 数据库存储（适合大规模）

## 6. 下一步计划

1. 确认技术方案选择
2. 设计详细系统架构
3. 抽离核心测试逻辑
4. 实现自动化引擎
5. 开发桌面 GUI（如需要）
